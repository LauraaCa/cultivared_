<!DOCTYPE html>
{% extends 'administrador/baseAdmin.html' %}
{% block body %}

<!-- Enlace a CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/adminperfil.css') }}">

<div class="container mt-5">
  <h1 class="text-center" id="panel-title">ESTADÍSTICAS</h1>

  <div class="row justify-content-center mt-4">
    
    <!-- Tarjeta de Total de Usuarios -->
    <div class="col-md-4 col-sm-6 mb-4">
      <div class="card text-center custom-card">
        <div class="card-body">
          <h5 class="card-title">Total de usuarios</h5>
          <p>Total: {{ num_usuarios }} (Vendedores: {{ num_vendedores }}, Compradores: {{ num_compradores }})</p>
        </div>
      </div>
    </div>

    <!-- Tarjeta de Productos Más Vendidos -->
    <div class="col-md-4 col-sm-6 mb-4">
      <div class="card text-center custom-card">
        <div class="card-body">
          <h5 class="card-title">Productos más vendidos</h5>
          <ul>
            {% for producto in productos_mas_vendidos %}
              <li>{{ producto }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Tarjeta de Productos Menos Vendidos -->
    <div class="col-md-4 col-sm-6 mb-4">
      <div class="card text-center custom-card">
        <div class="card-body">
          <h5 class="card-title">Productos menos vendidos</h5>
          <ul>
            {% for producto in productos_menos_vendidos %}
              <li>{{ producto }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Incluir Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Convertir datos de Jinja a JSON válido
  let productos_stock = JSON.parse('{{ productos_stock | tojson | safe }}');

  if (productos_stock.length > 0) {
    let nombresProductos = productos_stock.map(p => p.nombre);
    let cantidadesProductos = productos_stock.map(p => p.cantidad);

    new Chart(document.getElementById("productosChart"), {
      type: 'bar',
      data: {
        labels: nombresProductos,
        datasets: [{
          label: 'Stock de Productos',
          data: cantidadesProductos,
          backgroundColor: 'rgba(75, 192, 192, 0.5)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
  } else {
    document.getElementById("productosChart").style.display = "none";
  }
});
</script>

{% endblock %}
